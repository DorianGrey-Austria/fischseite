name: Deploy to Hostinger

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Setup Node.js (for potential build steps)
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install Dependencies (if package.json exists)
      run: |
        if [ -f package.json ]; then
          npm ci
        else
          echo "No package.json found, skipping npm install"
        fi

    - name: Run Tests (if available)
      run: |
        if [ -f package.json ] && npm list playwright > /dev/null 2>&1; then
          echo "Running Playwright tests..."
          npm test
        else
          echo "No tests configured, skipping test step"
        fi

    - name: Deploy via FTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./
        server-dir: /public_html/
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/test-*
          **/.github/**

    - name: Deployment Success Notification
      if: success()
      run: |
        echo "üéâ Deployment successful!"
        echo "üåê Website updated: https://$(echo ${{ secrets.FTP_HOST }} | sed 's/ftp\.//')"

    - name: Deployment Failure Notification
      if: failure()
      run: |
        echo "‚ùå Deployment failed!"
        echo "Check the logs above for details."